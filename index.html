<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplur Chatbot</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
</head>
<body>
    <div id="chat-container">
        <div id="chat-messages"></div>
        <input type="text" id="user-input" placeholder="Type your message...">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        let model;
        let tokenizer;
        let labelEncoder;
        let intentResponses;

        async function loadModel() {
            model = await tf.loadLayersModel('model/model.json');
            const tokenizerResponse = await fetch('model/tokenizer.json');
            tokenizer = await tokenizerResponse.json();
            const labelEncoderResponse = await fetch('model/label_encoder.json');
            labelEncoder = await labelEncoderResponse.json();
            const intentResponsesResponse = await fetch('model/intent_responses.json');
            intentResponses = await intentResponsesResponse.json();
        }

        function preprocess(text) {
            // Implement tokenization similar to Python preprocessing
            // This is a simplified version
            const words = text.toLowerCase().split(' ');
            const sequence = words.map(word => tokenizer.word_index[word] || 0);
            const padded = padSequence(sequence, 50);  // Adjust max_sequence_length as needed
            return tf.tensor2d([padded]);
        }

        function padSequence(sequence, maxLen) {
            if (sequence.length > maxLen) {
                return sequence.slice(0, maxLen);
            }
            return [...sequence, ...new Array(maxLen - sequence.length).fill(0)];
        }

        async function classifyIntent(userInput) {
            const inputTensor = preprocess(userInput);
            const prediction = await model.predict(inputTensor).array();
            const intentIndex = prediction[0].indexOf(Math.max(...prediction[0]));
            return labelEncoder[intentIndex];
        }

        function getResponse(intent, query) {
            if (intent in intentResponses) {
                let response = intentResponses[intent][Math.floor(Math.random() * intentResponses[intent].length)];
                
                // For intents that need placeholders filled
                if (["asset_creation", "workflow", "improvement", "game_design"].includes(intent)) {
                    // Simplified placeholder filling - you'd need more sophisticated parsing in a real application
                    const assetType = query.match(/character sprite|background image|3D model|animation/i)?.[0] || "asset";
                    const aiTool = query.match(/Stable Diffusion|3D mesh generation|AI upscaling/i)?.[0] || "AI tool";
                    const genre = query.match(/RPG|platformer|puzzle|strategy/i)?.[0] || "game";
                    const resolution = query.match(/\d+x\d+/i)?.[0] || "high resolution";
                    
                    response = response.replace('{0}', assetType)
                                       .replace('{1}', aiTool)
                                       .replace('{2}', genre)
                                       .replace('{3}', resolution);
                }
                
                return response;
            } else {
                return "I'm not sure how to respond to that. Could you please rephrase your question?";
            }
        }

        async function sendMessage() {
            const userInput = document.getElementById('user-input').value;
            document.getElementById('user-input').value = '';
            
            displayMessage('User: ' + userInput);
            
            const intent = await classifyIntent(userInput);
            const response = getResponse(intent, userInput);
            
            displayMessage('Chatbot: ' + response);
        }

        function displayMessage(message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageElement = document.createElement('p');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        loadModel();
    </script>
</body>
</html>
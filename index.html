<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplur Chatbot</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
</head>
<body>
    <h1>Multiplur Chatbot</h1>
    <input type="text" id="user-input" placeholder="Type a message">
    <button onclick="getResponse()">Send</button>
    <p id="response"></p>

    <script>
        let model;
        let tokenizer;
        let word_index;
        let intents;
        const max_seq_len = 50;  // Adjust this based on your model's input shape

        async function loadModel() {
            model = await tf.loadLayersModel('model/model.json');
            const tokenizerResponse = await fetch('model/tokenizer.json');
            const tokenizerData = await tokenizerResponse.json();
            tokenizer = JSON.parse(tokenizerData);
            word_index = JSON.parse(tokenizer.config.word_index);

            const intentResponse = await fetch('intent_responses.json');
            intents = await intentResponse.json();
            console.log('Model and data loaded successfully');
        }

        function preprocess(text) {
            let words = text.toLowerCase().split(' ');
            let sequence = words.map(w => word_index[w] || 1);  // Use 1 for OOV words
            const paddedSequence = new Array(max_seq_len).fill(0);
            for (let i = 0; i < Math.min(sequence.length, max_seq_len); i++) {
                paddedSequence[i] = sequence[i];
            }
            return tf.tensor2d([paddedSequence]);
        }

        async function getResponse() {
            const inputText = document.getElementById('user-input').value;
            const inputTensor = preprocess(inputText);
            const prediction = await model.predict(inputTensor);
            const responseIndex = tf.argMax(prediction, 1).dataSync()[0];
            console.log('Predicted intent index:', responseIndex);
            
            let response;
            if (intents[responseIndex] && intents[responseIndex].responses) {
                response = intents[responseIndex].responses[0];
            } else {
                response = "I'm sorry, I didn't understand that.";
            }
            
            document.getElementById('response').innerText = response;
        }

        loadModel();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplur Chatbot</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
</head>
<body>
    <div id="chat-container">
        <div id="chat-messages"></div>
        <input type="text" id="user-input" placeholder="Type your message...">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        let model;
        let labelEncoder;
        let intentResponses;

        async function loadModel() {
            try {
                model = await tf.loadLayersModel('model/model.json');
                const labelEncoderResponse = await fetch('model/label_encoder.json');
                labelEncoder = await labelEncoderResponse.json();
                const intentResponsesResponse = await fetch('intent_responses.json');
                intentResponses = await intentResponsesResponse.json();
                await loadTokenizer();  // Load the tokenizer
                console.log('Model and data loaded successfully');
            } catch (error) {
                console.error('Error loading model or data:', error);
            }
        }

        async function classifyIntent(userInput) {
            const inputTensor = preprocess(userInput);
            if (!inputTensor) {
                return 'error';
            }
            const prediction = await model.predict(inputTensor).array();
            const intentIndex = prediction[0].indexOf(Math.max(...prediction[0]));
            return labelEncoder[intentIndex];
        }

        function getResponse(intent, query) {
            if (intent in intentResponses) {
                return intentResponses[intent][Math.floor(Math.random() * intentResponses[intent].length)];
            } else {
                return "I'm not sure how to respond to that. Could you please rephrase your question?";
            }
        }

        async function sendMessage() {
            const userInput = document.getElementById('user-input').value;
            document.getElementById('user-input').value = '';
            
            displayMessage('User: ' + userInput);
            
            try {
                const intent = await classifyIntent(userInput);
                const response = getResponse(intent, userInput);
                displayMessage('Chatbot: ' + response);
            } catch (error) {
                console.error('Error processing message:', error);
                displayMessage('Chatbot: Sorry, I encountered an error. Please try again.');
            }
        }

        function displayMessage(message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageElement = document.createElement('p');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        loadModel();
    </script>
</body>
</html>
